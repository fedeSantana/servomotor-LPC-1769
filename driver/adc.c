
/*
 * mqe_motor.c
 *
 *  Created on: 11 dic. 2020
 *      Author: fer_o

 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "DR_ADC.h"
#include "RegsLPC1769.h"
#include "Inicializacion.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/
static volatile ADC_per_t *ADC = ADC_BASE;


/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/

/**
	\fn  	void ADC_start_conversion(void)
	\brief 	Inicia las conversiones del ADC
 	\author fer_o
 	\date 	24/11/20
	\return No hay retorno
*/
void ADC_start_conversion(void)
{
	ADC->ADCR.START = 1;
	//ADC->ADCR.BURST = 1; proba con esto si no anda lo de arriba, antes comenta lo de arriba

}

/**
	\fn  	uint32_t ADC_get_average(void)
	\brief 	Toma el promedio de las cuentas del ADC
 	\author fer_o
	\return uint32_t ADC_average: Promedio de las mediciones del ADC
*/


/**
	\fn  	void ADC_IRQHandler(void)
	\brief 	Handler de las interrupciones
 	\author fer_o
	\return No hay retorno
*/
/*
void ADC_IRQHandler(void)
{
	static uint32_t acummulator = 0;

	ADDR_reg_t ADDR2 = ADC->ADDR[2];

	ADC_buffer[ADC_buffer_index] = ADDR2.RESULT;
	acummulator += ADC_buffer[ADC_buffer_index];

	ADC_buffer_index++;
	ADC_buffer_index %= 4095;

	if (!ADC_buffer_index)
	{
		ADC_average = acummulator / 4095;
		acummulator = 0;
	}
}
*/
/**
	\fn  	TimeADC
	\brief 	Contador para iniciar cada medicion del ADC
 	\author fer_o
	\return No hay retorno
*/
void TimeADC(void)
{
	static uint32_t adc_counter = 0;

	adc_counter++;
	adc_counter %= 10; //Cantidad de ms

	if (!adc_counter)
	{
		ADC_start_conversion();
	}
}
